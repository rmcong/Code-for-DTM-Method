function [V, I] = LBP_uniform(X)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%DIP LAB%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% P=8 , R=1;
%%%X : image_block;
%%%V : labelled_image;
%%%I : uniform_lbp;  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

uniform_labels = [0 ...
        128 64 32 16 8 4 2 1 ...
        192 96 48 24 12 6 3 129 ...
        224 112 56 28 14 7 131 193 ...
        240 120 60 30 15 135 195 225 ...
        248 124 62 31 143 199 227 241 ...
        252 126 63 159 207 231 243 249 ...
        254 127 191 223 239 247 251 253 ...
        255];

w1 = (1/sqrt(2))^2;
w2 = (1-1/sqrt(2))*(1/sqrt(2));  

D = size(X);
sy = D(1);
sx = D(2);

Xi = zeros(sy+2,sx+2);
Xi(2:sy+1,2:sx+1) = X;  

Xi1 = zeros(sy+2,sx+2);  Xi2 = zeros(sy+2,sx+2);  Xi3 = zeros(sy+2,sx+2);  Xi4= zeros(sy+2,sx+2);
Xi5 = zeros(sy+2,sx+2);  Xi6 = zeros(sy+2,sx+2);  Xi7 = zeros(sy+2,sx+2);  Xi8 = zeros(sy+2,sx+2);

p1 = zeros(sy+2,sx+2);  p2 = zeros(sy+2,sx+2);  p3 = zeros(sy+2,sx+2);
p4 = zeros(sy+2,sx+2);  p5 = zeros(sy+2,sx+2);  p6 = zeros(sy+2,sx+2);
p7 = zeros(sy+2,sx+2);  p8 = zeros(sy+2,sx+2);  p9 = zeros(sy+2,sx+2);

p1(3:sy+2,3:sx+2) = X ;
p2(3:sy+2,2:sx+1) = w2*double(X) ;
p3(3:sy+2,1:sx) = X ;

p4(2:sy+1,3:sx+2) = w2*double(X) ;
p5(2:sy+1,2:sx+1) = (1-1/sqrt(2))^2*double(X) ;
p6(2:sy+1,1:sx) = w2*double(X) ;

p7(1:sy,3:sx+2) = X ;
p8(1:sy,2:sx+1) = w2*double(X) ;
p9(1:sy,1:sx) = X ;


Xi1 = w1*p1+ p2+p4 + p5 + 0.000001;     
Xi2(3:sy+2,2:sx+1) = X;                           
Xi3 = w1*p3 + p2 + p6 + p5 + 0.000001; 
Xi4(2:sy+1,1:sx) = X;                        
Xi5 = w1*p9 + p8 + p6 + p5 + 0.000001;  
Xi6(1:sy,2:sx+1) = X;                   
Xi7 = w1*p7 + p8 + p4 + p5 + 0.000001; 
Xi8(2:sy+1,3:sx+2) = X;                 

Xi = (Xi1>=Xi) + 2*(Xi2>=Xi) + 4*(Xi3>=Xi) + 8*(Xi4>=Xi) + 16*(Xi5>=Xi) + 32*(Xi6>=Xi) + 64*(Xi7>=Xi) + 128*(Xi8>=Xi);  %%Code

labelled_image = zeros(sy+2,sx+2);
uniform_lbp = zeros(sy+2,sx+2);

for i = 1:sx+2
    for j = 1:sy+2
        for label = 1:59
            if  label < 59
                if Xi(j,i) == uniform_labels(1,label)
                   labelled_image(j,i) = label;
                   uniform_lbp(j,i) = Xi(j,i);
                   break; 
                end
            else 
                if label == 59
                   labelled_image(j,i) = 59;
                   uniform_lbp(j,i) = 0;
                end
            end
        end
    end
end
        
V = labelled_image(2:sy+1,2:sx+1);
I = uniform_lbp(2:sy+1,2:sx+1);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% uniform_labels = [0 ...              %%00000000

%    128 64 32 16 8 4 2 1 ...           %%10000000 %01000000 %00100000 %00010000 
                                        %%00001000 %00000100 %00000010 %00000001 
                                       
%    192 96 48 24 12 6 3 129 ...        %%11000000 %01100000 %00110000 %00011000 
                                        %%00001100 %00000110 %00000011 %10000001
                                       
%    224 112 56 28 14 7 131 193 ...     %%11100000 %01110000 %00111000 %00011100
                                        %%00001110 %00000111 %10000011 %11000001
                                       
%    240 120 60 30 15 135 195 225 ...   %%11110000 %01111000 %00111100 %00011110
                                        %%00001111 %10000111 %11000011 %11100001
                                       
%    248 124 62 31 143 199 227 241 ...  %%11111000 %01111100 %00111110 %00011111
                                        %%10001111 %11000111 %11100011 %11110001
                                        
%    252 126 63 159 207 231 243 249 ... %%11111100 %01111110 %00111111 %10011111
                                        %%11001111 %11100111 %11110011 %11111001
                                        
%    254 127 191 223 239 247 251 253 ...%%11111110 %01111111 %10111111 %11011111
                                        %%11101111 %11110111 %11111011 %11111101
                                        
%    255];                              %%11111111
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%